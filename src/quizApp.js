var quizApp = angular.module('quizApp', []);

quizApp.factory('Quizzes', function() {
  return [
    {
        name: 'Cody Abercrombie',
        image: '13794391/c76cf758-eab8-11e5-8b3f-ea4473034911.jpg'
    },
    {
        name: 'Tariq Abouddafar',
        image: '13794390/c76c4f88-eab8-11e5-8393-446b7a4bbca1.jpg'
    },
    {
        name: 'Olivia Accardo',
        image: '13794393/c771be28-eab8-11e5-9370-a91669071421.jpg'
    },
    {
        name: 'Taylor Adams',
        image: '13794389/c7682930-eab8-11e5-91bf-3c37a271efc5.jpg'
    },
    {
        name: 'Shannon Adkins',
        image: '13794392/c76fafe8-eab8-11e5-844d-ab4579003767.jpg'
    },
    {
        name: 'JJ Aguhob',
        image: '13794388/c7635450-eab8-11e5-8481-75b9bec161e4.jpg'
    },
    {
        name: 'Cheryl Agustin',
        image: '13794394/c777d768-eab8-11e5-98de-bdbd6877c6eb.jpg'
    },
    {
        name: 'Randy Ahn',
        image: '13794397/c77f75ea-eab8-11e5-9f11-8cb453f6e9da.jpg'
    },
    {
        name: 'Lina Akkad',
        image: '13794396/c77e9c4c-eab8-11e5-8418-2a20c5482c8a.jpg'
    },
    {
        name: 'Jamie Anderson',
        image: '13794395/c77e7d5c-eab8-11e5-911a-8e723b29a239.jpg'
    },
    {
        name: 'Jasmine Andrews',
        image: '13794398/c782ad6e-eab8-11e5-8d35-1cd1632b940a.jpg'
    },
    {
        name: 'Khudor Annous',
        image: '13794400/c78c571a-eab8-11e5-9109-68cc68d7ef53.jpg'
    },
    {
        name: 'Tony Archibong',
        image: '13794399/c788a340-eab8-11e5-96a9-40239a2a478f.jpg'
    },
    {
        name: 'Gianni Arone',
        image: '13794402/c793bf96-eab8-11e5-8f6b-ac127ba90578.jpg'
    },
    {
        name: 'Sebastian Arriagada',
        image: '13794401/c793a8b2-eab8-11e5-8a64-650faa63fef7.jpg'
    },
    {
        name: 'Lauren Arso',
        image: '13794403/c796036e-eab8-11e5-9e90-04882835b2dc.jpg'
    },
    {
        name: 'Sar Ashjian',
        image: '13794989/18c62d6a-eabc-11e5-8d6a-d92799e4deb1.jpg'
    },
    {
        name: 'Heba Asmar',
        image: '13794993/18d976ae-eabc-11e5-9785-4015769e1e92.jpg'
    },
    {
        name: 'Amine Asmerom',
        image: '13794994/18dacc98-eabc-11e5-8f70-c5614a5c535b.jpg'
    },
    {
        name: 'Claudio Baccigalupo',
        image: '13794992/18d90c50-eabc-11e5-9f73-61841a70c33e.jpg'
    },
    {
        name: 'Patrick Bailey',
        image: '13794990/18d75d2e-eabc-11e5-988c-23fc20aed672.jpg'
    },
    {
        name: 'Talitha Baker',
        image: '13794991/18d83ef6-eabc-11e5-8158-6633e609e257.jpg'
    },
    {
        name: 'Sandy Bass',
        image: '13794995/18de3978-eabc-11e5-968b-9fa422e777f7.jpg'
    },
    {
        name: 'Suchir Batra',
        image: '13794996/18eb7070-eabc-11e5-908e-69186b120844.jpg'
    },
    {
        name: 'Evelyn Beagle',
        image: '13794998/18ec83f2-eabc-11e5-82bc-5df639da4984.jpg'
    },
    {
        name: 'Carly Beall',
        image: '13794999/18ef5122-eabc-11e5-9458-6297f7f76ebb.jpg'
    },
    {
        name: 'Malika Begin',
        image: '13794997/18ebb350-eabc-11e5-9f9b-5132207bcee4.jpg'
    },
    {
        name: 'Christine Benway',
        image: '13795001/18f29332-eabc-11e5-93df-57e4a8dc7228.jpg'
    },
    {
        name: 'Ryan Berg',
        image: '13795000/18f17cea-eabc-11e5-8282-3c2aac33546e.jpg'
    },
    {
        name: 'Dane Berman',
        image: '13795002/1900044a-eabc-11e5-8f69-e6a82210b9cb.jpg'
    },
    {
        name: 'Rian Bosak',
        image: '13795212/f77e06a4-eabc-11e5-882f-a01714b0a4af.jpg'
    },
    {
        name: 'Amy Boyer',
        image: '13795216/f794dab4-eabc-11e5-844b-38eaaf9ff106.jpg'
    },
    {
        name: 'Jon Brence',
        image: '13795218/f798366e-eabc-11e5-870e-2864d4439d0f.jpg'
    },
    {
        name: 'Darnell Brisco',
        image: '13795238/03c2a3ca-eabd-11e5-94d0-8e97c7bb3abb.jpg'
    },
    {
        name: 'Carter Brown',
        image: '13795214/f793cf02-eabc-11e5-9b89-37defde3e233.jpg'
    },
    {
        name: 'Jenna Browning',
        image: '13795215/f79466ce-eabc-11e5-8185-2941becf46d5.jpg'
    },
    {
        name: 'Allie Brunton',
        image: '13795213/f78d8110-eabc-11e5-95c3-5dd1f88bdf9c.jpg'
    },
    {
        name: 'Thomas Campana',
        image: '13795219/f7a19b6e-eabc-11e5-8897-fbed7a12580e.jpg'
    },
    {
        name: 'Karli Cantor',
        image: '13795222/f7a77570-eabc-11e5-9449-4c2e51b76e9a.jpg'
    },
    {
        name: 'Jesse Cantu Jr.',
        image: '13795220/f7a4d8c4-eabc-11e5-9568-3a6dd4ba936e.jpg'
    },
    {
        name: 'Ryan Canty',
        image: '13795221/f7a66d10-eabc-11e5-9913-df40a7bc0906.jpg'
    },
    {
        name: 'Dana Cargioli',
        image: '13795223/f7aa216c-eabc-11e5-9ac2-d9794a294500.jpg'
    },
    {
        name: 'Marlee Carlino',
        image: '13795224/f7ac5d88-eabc-11e5-953b-9939f6b79165.jpg'
    },
    {
        name: 'Casie Casanova',
        image: '13795225/f7b16544-eabc-11e5-92e7-cc38fdf627f7.jpg'
    },
    {
        name: 'Chris Chaisson',
        image: '13795306/6726d1fc-eabd-11e5-9b57-92e505ad6f55.jpg'
    },
    {
        name: 'Kenny Chapman',
        image: '13795308/674cc89e-eabd-11e5-94e7-6624570c114e.jpg'
    },
    {
        name: 'Jimmy Chen',
        image: '13795309/67513eba-eabd-11e5-8f53-8d44ac25d98c.jpg'
    },
    {
        name: 'Alan Cheung',
        image: '13795310/6751af12-eabd-11e5-9457-74ea407a724c.jpg'
    },
    {
        name: 'Terry Choe',
        image: '13795311/6752422e-eabd-11e5-87a5-33dbad093499.jpg'
    },
    {
        name: 'Jae Choi',
        image: '13795312/6752b7ae-eabd-11e5-9daa-e7cf9a39d931.jpg'
    },
    {
        name: 'Meggie Choi',
        image: '13795307/673fae16-eabd-11e5-9d0a-c42cc2749e6f.jpg'
    },
    {
        name: 'Sheauen Chung',
        image: '13795313/675455e6-eabd-11e5-85b9-a53523eac9d8.jpg'
    },
    {
        name: 'Kristine Claghorn',
        image: '13795314/675fff0e-eabd-11e5-8762-75b6fa178501.jpg'
    },
    {
        name: 'Daniel Clark',
        image: '13795327/679d0b1a-eabd-11e5-80ee-03f21fc0b239.jpg'
    },
    {
        name: 'Jenn Clark',
        image: '13795317/676abe26-eabd-11e5-9fa2-6f9c1faedbba.jpg'
    },
    {
        name: 'Lindsay Coburn',
        image: '13795318/676ae9fa-eabd-11e5-81bd-9a692d9a36d6.jpg'
    },
    {
        name: 'Nick Coffey',
        image: '13795315/6769bc7e-eabd-11e5-8b35-0fba84c2dc6b.jpg'
    },
    {
        name: 'Benjamin Cohen',
        image: '13795316/676a8532-eabd-11e5-9444-15c4f5bb1d8a.jpg'
    },
    {
        name: 'Ronit Cohn',
        image: '13795319/67766e06-eabd-11e5-9fc7-cb38d9a565ad.jpg'
    },
    {
        name: 'Adrian Coleman',
        image: '13795320/677b3dfa-eabd-11e5-871b-28b17dbf7d69.jpg'
    },
    {
        name: 'Jenny Conte',
        image: '13795321/677df810-eabd-11e5-801b-e48a643039d6.jpg'
    },
    {
        name: 'Lauren Coons',
        image: '13795323/6781de3a-eabd-11e5-8576-1285b1fa0e96.jpg'
    },
    {
        name: 'Jessica Cooper',
        image: '13795322/6780aeb6-eabd-11e5-958b-c1026aadc1e4.jpg'
    },
    {
        name: 'Sean Crebbs',
        image: '13795325/678db7e6-eabd-11e5-88c0-22c7ab0bd145.jpg'
    },
    {
        name: 'Kim Criss',
        image: '13795324/678ca95a-eabd-11e5-9586-f6406081e32d.jpg'
    },
    {
        name: 'Nick Crooks',
        image: '13795326/678ea692-eabd-11e5-8760-4d3e700f3ce6.jpg'
    }
  ];
});


quizApp.directive('kycFocus', [function () {
  return function focusIf(scope, element, attr) {
    scope.$watch(attr.kycFocus, function (newVal) {
      if (newVal) {
        scope.$evalAsync(function() {
          if(!(navigator.userAgent.match(/iPhone/i)) && !(navigator.userAgent.match(/iPod/i))) {
            element[0].focus();
          }
        });
      }
    });
  }
}]);

function QuizCtrl($scope, $interval, Quizzes) {
  function shuffle(array){
    for(var j, x, i = array.length; i; j = Math.floor(Math.random() * i), x = array[--i], array[i] = array[j], array[j] = x);
    return array;
  };

  $scope.quizzes = shuffle(Quizzes).slice(0, 10);
  var quizIndex = 0;
  var tickCount = $scope.quizzes.length;
  var timer = $interval();

  $scope.ticks = function() {
    return new Array(tickCount);
  };

  $scope.$watch('guess', function(value) {
    if($scope.guess.length == $scope.quiz.answer.length) {
      setOutcome()
    }
  });

  function setOutcome() {
    $interval.cancel(timer);
    $scope.quiz.outcome = ($scope.guess.toLowerCase() == $scope.quiz.answer.toLowerCase());
    mixpanel.track("Guess", {
      "guess": $scope.guess,
      "answer": $scope.quiz.answer,
      "name": $scope.quiz.name,
      "outcome": $scope.quiz.outcome,
      "index": quizIndex
    });
  };

  function baseUrl() {
    return 'https://cloud.githubusercontent.com/assets/7408595/';
  };

  $scope.isGuessed = function(quiz) {
    return typeof(quiz.outcome) != 'undefined'
  };

  $scope.isRight = function(quiz) {
    return quiz.outcome == true
  };

  $scope.isWrong = function(quiz) {
    return quiz.outcome == false
  };

  $scope.quizzes.over = function() {
    return quizIndex >= $scope.quizzes.length;
  };

  $scope.quizzes.next = function() {
    $scope.quiz = $scope.quizzes[quizIndex++];
    $scope.quiz.hint = baseUrl() + $scope.quiz.image;
    $scope.quiz.answer = $scope.quiz.name.substr(0,3).toLowerCase();
    $scope.guess = '';

    $scope.tick = 0;
    timer = $interval(function () {$scope.tick++}, 15000/tickCount, tickCount)
    timer.then(setOutcome);
  };

  $scope.quizzes.next();
}